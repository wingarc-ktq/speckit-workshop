# UI Prototype E2E Testing

**ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ä»•æ§˜æ›¸é§†å‹•é–‹ç™º** + **Playwright MCP** ã§AIæ”¯æ´E2Eãƒ†ã‚¹ãƒˆã‚’å®Ÿç¾ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

## ğŸ¯ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç‰¹å¾´

- **ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ä»•æ§˜æ›¸é§†å‹•**: æ—¥æœ¬èªã®ä»•æ§˜æ›¸ã‚’åŸºã«ãƒ†ã‚¹ãƒˆè‡ªå‹•ç”Ÿæˆ
- **Playwright MCPçµ±åˆ**: ç”»é¢æƒ…å ±ã‚’å–å¾—ã—ã¦Page Objectè‡ªå‹•ç”Ÿæˆ
- **AIæ”¯æ´é–‹ç™º**: GitHub Copilotã§ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã¨Page Objectã‚’åŠ¹ç‡çš„ã«å®Ÿè£…

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

```bash
# ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
pnpm install

# Playwrightãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pnpm test:e2e:install

# ç’°å¢ƒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ”ãƒ¼
cp .env.example .env

# ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ãƒ†ã‚¹ãƒˆã™ã‚‹å ´åˆã¯
# ui-prototype-e2eã§`pnpm dev`ã‚’å®Ÿè¡Œ

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pnpm test:e2e
```

## ğŸ¤– AIæ”¯æ´ã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆé–‹ç™º

### åŸºæœ¬çš„ãªé–‹ç™ºãƒ•ãƒ­ãƒ¼

1. **ä»•æ§˜æ›¸ä½œæˆ**: `tests/specs/{æ©Ÿèƒ½å}/{æ©Ÿèƒ½å}.md`ã«æ—¥æœ¬èªã§ãƒ†ã‚¹ãƒˆä»•æ§˜ã‚’è¨˜è¿°
2. **Copilotã«ä¾é ¼**: ä¸‹è¨˜ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ãƒ†ã‚¹ãƒˆç”Ÿæˆã‚’ä¾é ¼
3. **è‡ªå‹•å®Ÿè£…**: AIãŒPlaywright MCPã§ç”»é¢åˆ†æâ†’Page Objectç”Ÿæˆâ†’ãƒ†ã‚¹ãƒˆå®Ÿè£…
   - **ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸**: ç”»é¢å…¨ä½“ã®æ“ä½œã‚’`tests/pages/{æ©Ÿèƒ½å}Page.ts`ã«å®Ÿè£…
   - **ãƒ€ã‚¤ã‚¢ãƒ­ã‚°**: å†åˆ©ç”¨å¯èƒ½ãªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’`tests/pages/dialogs/`ã«åˆ†é›¢

### ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

```
E2Eãƒ†ã‚¹ãƒˆã®ä»•æ§˜æ›¸ã‚’å…ƒã«ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…ã—ãŸã„ã§ã™ã€‚
å¿…è¦ãªæƒ…å ±ï¼š
- ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®URL: [ä¾‹: http://localhost:5173/login]
- ä»•æ§˜æ›¸ãƒ•ã‚¡ã‚¤ãƒ«: [ä¾‹: tests/specs/login/login.md]
- å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«: [ä¾‹: tests/specs/login/login.spec.ts]
æ‰‹é †ï¼š
1. ã¾ãšPlaywright MCPã§ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦browser_snapshotã‚’å–å¾—
2. ç”»é¢ã®è¦ç´ æƒ…å ±ã‚’åŸºã«Page Object Modelã‚’æ›´æ–°
   - ãƒ¡ã‚¤ãƒ³ç”»é¢ã®æ“ä½œ: tests/pages/{æ©Ÿèƒ½å}Page.ts
   - ãƒ€ã‚¤ã‚¢ãƒ­ã‚°æ“ä½œ: tests/pages/dialogs/{ãƒ€ã‚¤ã‚¢ãƒ­ã‚°å}.ts
3. ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ä»•æ§˜æ›¸ã«åŸºã¥ã„ã¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…
```

### å¿…è¦ãªæƒ…å ±

- **ãƒ†ã‚¹ãƒˆå¯¾è±¡URL**: MCPã§ç”»é¢åˆ†æã™ã‚‹ãƒšãƒ¼ã‚¸
- **ä»•æ§˜æ›¸ãƒ‘ã‚¹**: å®Ÿè£…ã—ãŸã„ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ä»•æ§˜æ›¸
- **å‡ºåŠ›ãƒ‘ã‚¹**: ç”Ÿæˆã™ã‚‹ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
- **Page Objectã‚¯ãƒ©ã‚¹**: æ›´æ–°å¯¾è±¡ã®ãƒšãƒ¼ã‚¸ã‚¯ãƒ©ã‚¹ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰

## ğŸ“› å‘½åè¦å‰‡

### ãƒ•ã‚¡ã‚¤ãƒ«å‘½å

| ãƒ•ã‚¡ã‚¤ãƒ«ç¨®é¡           | å‘½åè¦å‰‡             | ä¾‹                      |
| ---------------------- | -------------------- | ----------------------- |
| **ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ä»•æ§˜æ›¸** | `kebab-case.md`      | `folder-create.md`      |
| **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**     | `kebab-case.spec.ts` | `folder-create.spec.ts` |
| **Page Object**        | `PascalCase.ts`      | `FolderPage.ts`         |
| **Dialog**             | `PascalCase.ts`      | `FolderCreateDialog.ts` |
| **Fixture**            | `camelCase.ts`       | `testUsers.ts`          |
| **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**       | `kebab-case`         | `playwright.config.ts`  |

### ã‚³ãƒ¼ãƒ‰å‘½å

| è¦ç´           | å‘½åè¦å‰‡           | ä¾‹                          |
| ------------- | ------------------ | --------------------------- |
| **ã‚¯ãƒ©ã‚¹å**  | `PascalCase`       | `FolderPage`, `ErrorDialog` |
| **é–¢æ•°/å¤‰æ•°** | `camelCase`        | `createFolder`              |
| **ãƒ†ã‚¹ãƒˆå**  | æ—¥æœ¬èª             | `ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã§ãã‚‹ã“ã¨`  |
| **å®šæ•°**      | `UPPER_SNAKE_CASE` | `MAX_FOLDER_NAME`           |

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
tests/
â”œâ”€â”€ specs/                           # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â””â”€â”€ {æ©Ÿèƒ½å}/                     # æ©Ÿèƒ½ã”ã¨ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”‚       â”œâ”€â”€ {æ©Ÿèƒ½å}.md               # åŸºæœ¬æ©Ÿèƒ½ã®ä»•æ§˜æ›¸
â”‚       â”œâ”€â”€ {æ©Ÿèƒ½å}.spec.ts          # åŸºæœ¬æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
â”‚       â”œâ”€â”€ {æ©Ÿèƒ½å}-{æ“ä½œ}.md         # ç‰¹å®šæ“ä½œã®ä»•æ§˜æ›¸
â”‚       â””â”€â”€ {æ©Ÿèƒ½å}-{æ“ä½œ}.spec.ts    # ç‰¹å®šæ“ä½œã®ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ pages/                           # Page Object Model
â”‚   â”œâ”€â”€ BasePage.ts                  # ãƒ™ãƒ¼ã‚¹ãƒšãƒ¼ã‚¸ã‚¯ãƒ©ã‚¹
â”‚   â”œâ”€â”€ {æ©Ÿèƒ½å}Page.ts               # å„æ©Ÿèƒ½ã®ãƒšãƒ¼ã‚¸ã‚¯ãƒ©ã‚¹
â”‚   â””â”€â”€ dialogs/                     # ãƒ€ã‚¤ã‚¢ãƒ­ã‚°å°‚ç”¨Page Object
â”‚       â”œâ”€â”€ {æ©Ÿèƒ½å}{æ“ä½œ}Dialog.ts    # ç‰¹å®šæ“ä½œã®ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
â”‚       â””â”€â”€ ErrorDialog.ts           # ã‚¨ãƒ©ãƒ¼ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆå…±é€šï¼‰
â””â”€â”€ fixtures/                        # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    â””â”€â”€ {ãƒ‡ãƒ¼ã‚¿å}.ts                 # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
playwright-report/                   # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœãƒ¬ãƒãƒ¼ãƒˆ
test-results/                        # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœã®è©³ç´°ãƒ‡ãƒ¼ã‚¿
.github/
â”œâ”€â”€ workflows/
â”‚   â””â”€â”€ playwright.yml               # CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
â””â”€â”€ instructions/
    â””â”€â”€ copilot-instructions.md      # AIæ”¯æ´ç”¨æŒ‡ç¤º
.vscode/
â””â”€â”€ mcp.json                         # MCPè¨­å®šï¼ˆVS Code + Copilotçµ±åˆï¼‰
```

## ğŸ“ ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ä»•æ§˜æ›¸ã®æ›¸ãæ–¹

```markdown
# {æ©Ÿèƒ½å}

## {ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å}ï¼ˆã€Œã€œã™ã‚‹ã“ã¨ã€ã§çµ‚ã‚ã‚‹ï¼‰

### ãƒ‡ãƒ¼ã‚¿ï¼ˆå¿…è¦ãªå ´åˆï¼‰

| param1 | param2 |
| ------ | ------ |
| value1 | value2 |

### å‰ææ¡ä»¶ï¼ˆå¿…è¦ãªå ´åˆï¼‰

- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«å¿…è¦ãªçŠ¶æ…‹ã‚„æ¡ä»¶ã‚’è¨˜è¿°
- ä¾‹: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«åŒåã®ãƒ•ã‚©ãƒ«ãƒ€ãŒå­˜åœ¨ã—ãªã„ã“ã¨
- ä¾‹: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«å‰Šé™¤å¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹ã“ã¨

### æ‰‹é †

1. å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³
2. å…¥åŠ›ãƒ»æ“ä½œ
3. æœŸå¾…ã•ã‚Œã‚‹çµæœã®ç¢ºèª

### äº‹å¾Œå‡¦ç†ï¼ˆå¿…è¦ãªå ´åˆï¼‰

- ãƒ†ã‚¹ãƒˆå®Œäº†å¾Œã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†ã‚’è¨˜è¿°
- ä¾‹: ä½œæˆã—ãŸãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã™ã‚‹
- ä¾‹: å¤‰æ›´ã—ãŸè¨­å®šã‚’å…ƒã«æˆ»ã™
```

### ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ä½¿ã„åˆ†ã‘

- **ãƒ‡ãƒ¼ã‚¿**: ãƒ†ã‚¹ãƒˆã§ä½¿ç”¨ã™ã‚‹å…¥åŠ›å€¤ãƒ»æœŸå¾…å€¤
- **å‰ææ¡ä»¶**: ãƒ†ã‚¹ãƒˆé–‹å§‹å‰ã«å¿…è¦ãªçŠ¶æ…‹ï¼ˆbeforeEachã§å®Ÿè£…ï¼‰
- **æ‰‹é †**: ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œã‚¹ãƒ†ãƒƒãƒ—
- **äº‹å¾Œå‡¦ç†**: ãƒ†ã‚¹ãƒˆå®Œäº†å¾Œã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆafterEachã§å®Ÿè£…ï¼‰

## ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

### åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# Playwrightãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆåˆå›ã®ã¿ï¼‰
pnpm test:e2e:install
```

### ãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰

```bash
# åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰
pnpm test:e2e              # å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pnpm test:e2e:headed       # ãƒ–ãƒ©ã‚¦ã‚¶è¡¨ç¤ºä»˜ã
pnpm test:e2e:ui           # ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰
pnpm test:e2e:debug        # ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰
pnpm test:e2e:report       # ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º

# ãƒ–ãƒ©ã‚¦ã‚¶åˆ¥å®Ÿè¡Œ
pnpm test:e2e:chromium     # Chromiumã®ã¿
pnpm test:e2e:firefox      # Firefoxã®ã¿
pnpm test:e2e:webkit       # WebKitã®ã¿
pnpm test:e2e:mobile       # ãƒ¢ãƒã‚¤ãƒ«ãƒ–ãƒ©ã‚¦ã‚¶
```

## ãƒ†ã‚¹ãƒˆç’°å¢ƒ

| ç’°å¢ƒ  | URL                   | Basename | ç”¨é€”         |
| ----- | --------------------- | -------- | ------------ |
| Local | http://localhost:5173 | ãªã—     | é–‹ç™ºæ™‚ãƒ†ã‚¹ãƒˆ |

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### APIå‘¼ã³å‡ºã—ã§500ã‚¨ãƒ©ãƒ¼ãŒè¿”ã•ã‚Œã‚‹å ´åˆ

**åŸå› **: Playwrightã§ `page.evaluate()` ã‚’ä½¿ç”¨ã—ã¦å¤–éƒ¨APIã‚’ç›´æ¥å‘¼ã³å‡ºã™å ´åˆã€MSWã®ãƒ¢ãƒƒã‚¯ãŒæ©Ÿèƒ½ã—ã¾ã›ã‚“ã€‚

**è§£æ±ºæ–¹æ³•**: `page.route()` ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã—ã¦ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰å†…ã§ãƒ¢ãƒƒã‚¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚

```typescript
// âŒ ä¸æ­£: å¤–éƒ¨URLã‚’ç›´æ¥å‘¼ã³å‡ºã—ï¼ˆMSWãŒæ©Ÿèƒ½ã—ãªã„ï¼‰
const { status, body } = await page.evaluate(async (baseUrl) => {
  const res = await fetch(`${baseUrl}/files/doc-001`);
  return { status: res.status, body: await res.json() };
}, 'http://localhost:3000/api');

// âœ… æ­£ã—ã„: page.route() ã§ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆ
await page.route('**/api/files/doc-001', async (route) => {
  await route.fulfill({
    status: 200,
    contentType: 'application/json',
    body: JSON.stringify(mockData),
  });
});

// ç›¸å¯¾ãƒ‘ã‚¹ã§APIã‚’å‘¼ã³å‡ºã—
const body = await page.evaluate(async () => {
  const res = await fetch('/api/files/doc-001');
  return res.json();
});
```

### ãƒ†ã‚¹ãƒˆãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã™ã‚‹å ´åˆ

**åŸå› **: MSWã®ãƒ­ãƒ¼ãƒ‰å¾…æ©ŸãŒé•·ã™ãã‚‹ã€ã¾ãŸã¯è¦ç´ ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã€‚

**è§£æ±ºæ–¹æ³•**:

```typescript
// MSWãƒ­ãƒ¼ãƒ‰å¾…æ©Ÿã‚’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå¯¾å¿œã«
try {
  await page.waitForFunction(() => navigator.serviceWorker?.controller !== null, {
    timeout: 15000,
  });
} catch (e) {
  console.log('âš ï¸ MSWãƒ­ãƒ¼ãƒ‰å¾…æ©Ÿã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€ãƒšãƒ¼ã‚¸ãƒ«ãƒ¼ãƒˆã§ã‚«ãƒãƒ¼');
}

// è¦ç´ å¾…æ©Ÿæ™‚ã¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’æ˜ç¤ºçš„ã«æŒ‡å®š
await page.waitForSelector('[data-testid="element"]', { timeout: 10000 });
```

**è¦ç´ ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ**

```typescript
// MCPç¢ºèªæ¸ˆã¿ã®è¦ç´ ã‚’ä½¿ç”¨
await page.getByTestId('submit-button');
await page.getByRole('button', { name: 'Submit' });
```

**ãƒ†ã‚¹ãƒˆãŒä¸å®‰å®šãªå ´åˆ**

```bash
# ãƒªãƒˆãƒ©ã‚¤å›æ•°ã‚’å¢—ã‚„ã™
pnpm test --retries=3

# UIãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œã—ã¦è©³ç´°ã‚’ç¢ºèª
pnpm test:e2e:ui
```

## ğŸ“š å‚è€ƒè³‡æ–™

- [Playwright å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://playwright.dev/)
- [Microsoft Playwright MCP](https://github.com/microsoft/playwright-mcp)
- [Model Context Protocol](https://modelcontextprotocol.io/)
